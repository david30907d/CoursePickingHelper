<!DOCTYPE html>
<html lang="zh-tw" class="han-la">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>選課小幫手</title>
        <script type="text/javascript"></script>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/Han/2.3.0/han.css" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootst	rap/3.3.1/css/bootstrap.min.css">
        <link href="font-awesome-4.3.0/css/font-awesome.min.css" rel="stylesheet">
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Han/2.3.0/han.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <style>
        /*這裡開始是我寫的，選取表單和選單上的id，並把顏色反白*/
        #icon-text, #icon-text1, #icon-text2, #icon-text3, #icon-text4, #icon-text5
        {
        	color: white;
        	font-family: "Microsoft JhengHei";
        	font-size: 100%;
        	font-style: italic;
        }
        body
        {
        	background-color:#3074B5;
        	background-repeat:no-repeat;
        	background-attachment: fixed;
        	font-family: "Microsoft JhengHei";
        }
        /*最後改的p是相簿的英文字*/
        #elective-post
        {
        	margin-bottom: 10px;
        }
        #btn-tools
        {
        	padding: 0;
        }
        #classification
        {
        	padding: 0px;
        }
		/*修改table的border*/
        #time-table tbody th
        {
        	white-space: nowrap;
        	font-size: 80%;
        	height:55px;
        }
        #time-table th
        {
        	text-align: center;
        }
        #time-table button.btn-link
        {
        	text-align: center;
        	color:black;
        }
        #time-table div.title
        {
        	text-align: center;
        	font-size: 120%;
        	padding-bottom: 3px;
        }
        #time-table div.location
        {
        	text-align: left;
        	font-size: 80%;
        }
        #time-table div.professor
        {
        	text-align: right;
        	font-size: 80%;
        }
        /*table的屬性結束*/
        </style>
    </head>

    <body>

        <!--選取系級的表單結束-->
        <div class="container-fluid">
            <div class="col-md-9">
                <h2 style="text-align:center;" id="curriculum-title">課表</h2>
                <div class="table-responsive" id="time-table">
                    <table class="table table-striped table-hover table-condensed table-bordered">
                        <thead>
                            <tr class="info">
                                <th style="width: 1px">時間</th>
                                <th style="width: 20%">一</th>
                                <th style="width: 20%">二</th>
                                <th style="width: 20%">三</th>
                                <th style="width: 20%">四</th>
                                <th style="width: 20%">五</th>
                            </tr>
                        </thead>
                        <tbody>
								<tr data-hour="1" class="active">
									<th>08:10 - 09:00</th>
									<td data-day="1"></td>
									<td data-day="2"></td>
									<td data-day="3"></td>
									<td data-day="4"></td>
									<td data-day="5"></td>
								</tr>
								<tr data-hour="2" class="active">
									<th>09:10 - 10:00</th>
									<td data-day="1"></td>
									<td data-day="2"></td>
									<td data-day="3"></td>
									<td data-day="4"></td>
									<td data-day="5"></td>
								</tr>
								<tr data-hour="3" class="active">
									<th>10:10 - 11:00</th>
									<td data-day="1"></td>
									<td data-day="2"></td>
									<td data-day="3"></td>
									<td data-day="4"></td>
									<td data-day="5"></td>
								</tr>
								<tr data-hour="4" class="active">
									<th>11:10 - 12:00</th>
									<td data-day="1"></td>
									<td data-day="2"></td>
									<td data-day="3"></td>
									<td data-day="4"></td>
									<td data-day="5"></td>
								</tr>
								<tr data-hour="5" class="active">
									<th>13:10 - 14:00</th>
									<td data-day="1"></td>
									<td data-day="2"></td>
									<td data-day="3"></td>
									<td data-day="4"></td>
									<td data-day="5"></td>
								</tr>
								<tr data-hour="6" class="active">
									<th>14:10 - 15:00</th>
									<td data-day="1"></td>
									<td data-day="2"></td>
									<td data-day="3"></td>
									<td data-day="4"></td>
									<td data-day="5"></td>
								</tr>
								<tr data-hour="7" class="active">
									<th>15:10 - 16:00</th>
									<td data-day="1"></td>
									<td data-day="2"></td>
									<td data-day="3"></td>
									<td data-day="4"></td>
									<td data-day="5"></td>
								</tr>
								<tr data-hour="8" class="active">
									<th>16:10 - 17:00</th>
									<td data-day="1"></td>
									<td data-day="2"></td>
									<td data-day="3"></td>
									<td data-day="4"></td>
									<td data-day="5"></td>
								</tr>
							</tbody>
                    </table>
                </div>
            </div>
            <br>
            <!--會出現系選修和體育、通識-->
            <div class="col-md-3" id="classification">
                <div class="container-fluid">
                    <div class="col-xs-4" id="btn-tools">
                        <button type="button" class="btn btn-success btn-block" data-toggle="modal" data-target="#search">
                        <span class="fa fa-search fa-1x fa-fw"></span>
                        </button>
                    </div>
                    <div class="col-xs-4" id="btn-tools">
                        <button type="button" class="btn btn-warning btn-block" id="clear-class-button">
                        <span class="fa fa-eraser fa-1x fa-fw"></span>
                        </button>
                    </div>
                    <div class="col-xs-4" id="btn-tools">
                        <button type="button" class="btn btn-danger btn-block" id="clear-button">
                        <span class="fa fa-trash fa-1x fa-fw"></span>
                        </button>
                    </div>
                </div>
                <br>
                <div calss="row">
                    <div class="col-xs-12" style = "background-color:#D9EDF7">
                        <div calss="row">
                            <div class="col-xs-3 col-xs-3"><input type="checkbox" value="" id="elective-check" checked>系選修</div>
                            <div class="col-xs-3 col-xs-3"><input type="checkbox" value="" id="specific-time-check" checked>指定時間</div>
                            <div class="col-xs-3 col-xs-3"><input type="checkbox" value="" id="specific-check" checked>指定搜尋</div>
                            <div class="col-xs-3 col-xs-3"><input type="checkbox" value="" id="general-check" checked>通識</div>
                            <div class="col-xs-3 col-xs-3"><input type="checkbox" value="" id="PE-check" checked>體育</div>
                        </div>
                        <select multiple class="form-control" id="bulletin-post">
                        	<optgroup label="系選修" id="elective-post" style="display:">
                        	</optgroup>
                        	<optgroup label="指定時間" id="specific-time-post" style="display:"></optgroup>
                        	<optgroup label="指定搜尋" id="specific-post" style="display:"></optgroup>
                        	<optgroup label="通識" id="general-post" style="display:">  	
                        	</optgroup>
                        	<optgroup label="體育" id="PE-post" style="display:">      		
                        	</optgroup>                           
                        </select>
                    </div>
                </div>
                
                <div class="modal fade modal fade bs-example-modal-lg" id="search" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h3 class="modal-title" id="myModalLabel"><span class="fa fa-search fa-1x fa-fw"></span>課程查詢</h3>
                            </div>
                            
				        <div class="modal-body">
				            <form class="form-horizontal">
				                <div class="form-group">
				                    <label for="v_year" class="col-xs-2 control-label">學期</label>
				                    <div class="col-xs-10">
				                        <select class="form-control" name="v_year" id="v_year">
				                        	<option value="0">請選擇學期</option>
				                            <option value="103_2">1032</option>
				                            <option value="103_1">1031</option>
				                            <option value="102_2">1022</option>
				                            <option value="102_1">1021</option>
				                        </select>
				                    </div>
				                </div>
				                <div class="form-group">
				                    <label for="v_career" class="col-xs-2 control-label">學制</label>
				                    <div class="col-xs-10">
				                        <select class="form-control" name="v_career" id="v_career">
				                            <option value="0">請選擇學制</option>
				                            <option value="U">學士班</option>
				                            <option value="G">碩士班</option>
				                            <option value="D">博士班</option>
				                            <option value="R">產專班</option>
				                            <option value="W">碩專班</option>
				                            <option value="N">進修學士班</option>
				                        </select>
				                    </div>
				                </div>
				                <div class="form-group">
				                    <label for="v_major" class="col-xs-2 control-label">系所</label>
				                    <div class="col-xs-10">
				                        <select class="form-control" name="v_major" id="v_major">
				                            <option value="0">請選擇系所</option>
				                            <option value="C10">文學院</option>
				                            <option value="C20">管理學院</option>
				                            <option value="C30">農業暨自然資源學院</option>
				                            <option value="中國文學系學士班">中國文學系學士班</option>
				                            <option value="外國語文學系學士班">外國語文學系學士班</option>
				                            <option value="U13">歷史學系學士班</option>
				                            <option value="U21">財務金融學系學士班</option>
				                            <option value="U23">企業管理學系學士班</option>
				                            <option value="U24">法律學系學士班</option>
				                            <option value="U28">會計學系學士班</option>
				                            <option value="U29">資訊管理學系學士班</option>
				                            <option value="U30F">景觀與遊憩學士學位學程</option>
				                            <option value="U30G">生物科技學士學位學程</option>
				                            <option value="U30H">國際農企業學士學位學程</option>
				                            <option value="U31">農藝學系學士班</option>
				                            <option value="U32">園藝學系學士班</option>
				                            <option value="U33A">森林學系林學組學士班</option>
				                            <option value="U33B">森林學系木材科學組學士班</option>
				                            <option value="U34">應用經濟學系學士班</option>
				                            <option value="U35">植物病理學系學士班</option>
				                            <option value="U36">昆蟲學系學士班</option>
				                            <option value="U37">動物科學系學士班</option>
				                            <option value="U38A">獸醫學系學士班</option>
				                            <option value="U38B">獸醫學系學士班</option>
				                            <option value="U39">土壤環境科學系學士班</option>
				                            <option value="U40">生物產業機電工程學系學士班</option>
				                            <option value="U42">水土保持學系學士班</option>
				                            <option value="U43">食品暨應用生物科技學系學士班</option>
				                            <option value="U44">行銷學系學士班</option>
				                            <option value="U51">化學系學士班</option>
				                            <option value="U52">生命科學系學士班</option>
				                            <option value="U53A">應用數學系學士班</option>
				                            <option value="U53B">應用數學系學士班</option>
				                            <option value="U54A">物理學系一般物理組學士班</option>
				                            <option value="U54B">物理學系光電物理組學士班</option>
				                            <option value="資訊科學與工程學系學士班">資訊科學與工程學系學士班</option>
				                            <option value="U60F">學士後太陽能光電系統應用學士學位學程</option>
				                            <option value="U61B">機械工程學系學士班</option>
				                            <option value="U61A">機械工程學系學士班</option>
				                            <option value="U62A">土木工程學系學士班</option>
				                            <option value="U62B">土木工程學系學士班</option>
				                            <option value="U63">環境工程學系學士班</option>
				                            <option value="U64B">電機工程學系學士班</option>
				                            <option value="U64A">電機工程學系學士班</option>
				                            <option value="U65">化學工程學系學士班</option>
				                            <option value="U66">材料科學與工程學系學士班</option>
				                        </select>
				                    </div>
				                </div>
				                <div class="form-group">
				                    <label for="v_level" class="col-xs-2 control-label">年級</label>
				                    <div class="col-xs-10">
				                        <select class="form-control" name="v_level" id="v_level">
				                        	<option value="0">請選擇年級</option>
				                            <option value="1">一年級</option>
				                            <option value="2">二年級</option>
				                            <option value="3">三年級</option>
				                            <option value="4">四年級</option>
				                            <option value="5">五年級</option>
				                        </select>
				                    </div>
				                </div>
				                <div class="form-group">
				                    <label for="class_credit" class="col-xs-2 control-label">學分數</label>
				                    <div class="col-xs-10">
				                        <input type="teacher" class="form-control" id="class_credit" value="0" readonly><!--不讓使用者自己改學分數-->
				                    </div>
				                </div>
				                <div class="form-group">
				                    <label for="class_title" class="col-xs-2 control-label">課程名稱</label>
				                    <div class="col-xs-10">
				                        <input type="class" class="form-control" id="class_title">
				                    </div>
				                </div>
				                <div class="form-group">
				                    <label for="class_code" class="col-xs-2 control-label">課程代碼</label>
				                    <div class="col-xs-10">
				                        <input type="class" class="form-control" id="class_code">
				                    </div>
				                </div>
				                <div class="form-group">
				                    <label for="class_teacher" class="col-xs-2 control-label">授課教師</label>
				                    <div class="col-xs-10">
				                        <input type="teacher" class="form-control" id="class_teacher">
				                    </div>
				                </div>
				                <div class="form-group">
				                    <label for="class_room" class="col-xs-2 control-label">上課教室</label>
				                    <div class="col-xs-10">
				                        <input type="teacher" class="form-control" id="class_room">
				                    </div>
				                </div>
				                <div class="form-group">
				                    <label class="col-xs-12 control-label" style="text-align: center;">欄位留白表示該條件不設限制</label>
				                </div>
				                <div class="form-group">
				                    <a class="btn btn-lg col-sm-3 col-sm-offset-1" href="https://onepiece.nchu.edu.tw/cofsys/plsql/crseqry_home" target="_blank"><span class="fa fa-graduation-cap fa-1x fa-fw"></span>選課系統</a>
				                    <a class="btn btn-lg col-sm-3" href="http://cah.nchu.edu.tw/class/class_plan.php?new=Y&d_id=3" target="_blank"><span class="fa fa-book fa-1x fa-fw"></span>通識中心</a>
				                    <a class="btn btn-lg col-sm-3" href="https://nchu-am.nchu.edu.tw/nidp/idff/sso?id=3&sid=0&option=credential&sid=0" target="_blank"><span class="fa fa-external-link fa-1x fa-fw"></span>單一簽入</a>
				                </div>
				            </form>
				        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-success" data-dismiss="modal" id="specific_search">Submit</button>
                        </div>
                        </div>
                    </div>
  	            </div>
            </div>
            <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script>
		(function($){
		//先定義JQuery為$，不要讓它衝突
		//var courses = null;
			$(function(){
				//當文件準備好的時候，讀入json檔
				$.getJSON('json/proto-course.json', function(json){  //getJSON會用function(X)傳回X的物件或陣列
					window.credits=0//一開始的學分數是0
					window.courses = {};//宣告一個空的物件
					window.course_of_majors = {};//宣告一個空的物件
					window.course_of_day = {};	//這是宣告日期的陣列
					window.teacher_course = {};	//這是以老師姓名為index的陣列
					window.name_of_course = {};	//這是以課程名稱為index的陣列
					$.each(json.course, function(ik, iv){
						if(typeof(window.course_of_majors[iv.for_dept]) == 'undefined')//如果這一列(列的名稱為索引值key)是空的也就是undefined，那就對他進行初始化，{}物件裡面可以放任意的東西，在下面會把很多陣列塞進這個物件裡面
							window.course_of_majors[iv.for_dept] = {};  
						if(typeof(window.course_of_majors[iv.for_dept][iv.class]) == 'undefined'){
							window.course_of_majors[iv.for_dept][iv.class] = [];//如果這一行(列的名稱為索引值key)是空的也就是undefined，那就對他進行初始化，[]裡面的是放陣列
						}
						window.course_of_majors[iv.for_dept][iv.class].push(iv.code);//把東西推進這個陣列裡，概念跟stack一樣
						window.courses[iv.code] = iv;//這邊可以直接把選課號當作索引值key，裡面的值為object
						$.each(iv.time_parsed, function(jk, jv){//建立日期的陣列				
							$.each(jv.time, function(mk, mv){
								if(typeof(window.course_of_day[jv.day])=='undefined'){
									window.course_of_day[jv.day]={};
								}
								if(typeof(window.course_of_day[jv.day][mv])=='undefined'){
									window.course_of_day[jv.day][mv]=[];
								}
								window.course_of_day[jv.day][mv].push(iv);
							})
						})		
						if(typeof(window.teacher_course[iv.professor])=='undefined'){//建立老師名稱的陣列
							window.teacher_course[iv.professor]=[];
						}
						window.teacher_course[iv.professor].push(iv);	
						if(typeof(window.name_of_course[iv.title_parsed.zh_TW])=='undefined'){//中文課名陣列
							window.name_of_course[iv.title_parsed.zh_TW]=[];
						}																				
						window.name_of_course[iv.title_parsed.zh_TW].push(iv);
						if(typeof(window.name_of_course[iv.title_parsed.en_US])=='undefined'){//英文課名陣列
							window.name_of_course[iv.title_parsed.en_US]=[];
						}																				
						window.name_of_course[iv.title_parsed.en_US].push(iv);
					});					
				});
				$("#v_career").change(function()
				{
					select_degree($("#v_career").val());
				});				
				var select_degree = function(degree)
				{
					cozsnsole.log(degree);
					switch(degree)
					{
						case "U":

						case "G":

						case "D":

						case "R":

						case "W":

						case "N":
					}
				};	
				/*//這段是均民的原始碼
				var serializearray=function(){//比較好的方法來取option 的value!!!!
					$a = $($0)//取到年級選單
					//[<form class=​"form-horizontal">​…​</form>​]
					$a.serializeArray()
					[Objectname: "v_year"value: "103_2"__proto__: Object, Objectname: "v_career"value: "U"__proto__: Object, Objectname: "v_major"value: "C10"__proto__: Object, Objectname: "v_level"value: "1"__proto__: Object]
					$a.serializeArray()[0].name
					"v_year"
					$a.serializeArray()[1].value
					"U"
				}*/	
				$("#bulletin-post").delegate("option", "click", function(){//delegate可以去抓到還不存在的東西，第一個$()是指作用的區域，delegate的()裡面就是option，dblclick是事件
					var boolean = confirm("確認添加此課程?" + "\n" + "Are you sure to enroll this class?");
					if(boolean){
						var language = $("#change-language").val();
						var code = $(this).val();//this會代表我抓到的那個東西，也就是option						
						course = courses[code];			
						add_course($('#time-table'), course, "zh_TW");	
					}
				});				
				$("#specific_search").click(function()	//可以用課號搜尋，把input的的課號用.val()取出
				//$("#ok-button").click(function()
				{											
					var major=$("#v_major").val();	//取到系
					var level = $("#v_level").val();	//取到年級
					reset();
					//console.log(major+" "+level);
					$.each(course_of_majors[major][level], function(ik, iv){
							if(courses[iv].obligatory_tf==true){
								add_course($('#time-table'), courses[iv], "zh_TW");
							}
					});
					$.each(course_of_majors[major], function(ik, iv){				
						$.each(iv,function(jk, jv){													
							if(courses[jv].obligatory_tf==false){
								//console.log(jv);
								bulletin_post($("#elective-post"),courses[jv], "zh_TW");
							}						
						})
					})//以上為必修 選修填入	
					//可以用課號搜尋，把input的的課號用.val()取出
					var code = $("#class_code").val();	//課號搜尋
					if(code!=""){
						bulletin_post($("#specific-post"),courses[code], "zh_TW");
					}		
					var class_title=$("#class_title").val();//課程名稱搜尋
					if(class_title!=""){
						$.each(name_of_course, function(ik, iv){
							if(ik.search(class_title)!=-1){
								$.each(iv,function(jk, jv){
									bulletin_post($("#specific-post"),jv, "zh_TW");
								});
							}							
						})												
					}	
					var teacher = $("#class_teacher").val();//老師名稱搜尋
					if(teacher!=""){
						$.each(teacher_course[teacher], function(ik, iv){							
							bulletin_post($("#specific-post"),iv, "zh_TW");
						});
					}			
				});

				$("#clear-button").click(function()
				{
					$('#time-table td').empty(); //把目前的time-table清空，好讓下個年級的課程能夠乾淨的顯示
					$('#elective-post').empty();//清掉選修課程
				});
				$("#time-table").delegate("span", "click", function(){//這是用來把一整個課程都刪掉的按鈕
					$target = $(this).closest("td");
					var code = $(this).next("input").val();
					var boolean = confirm("是否刪除此課程?" + "\n" + "Are you sure you really want to drop this course?");					
					if(boolean)
					{
						delete_course($('#time-table'), courses[code]);	//就跟add_course一樣，只是把填東西改成刪掉			
					}					
				});				
				$("td").click(function(){	//按一下課表欄位就有課程彈出來了
					if($(this).text()==""){ //我現在才知道null!=""
						var major=$("#v_major").val();	//取到系
						var day=$(this).attr("data-day");
						var hour=$(this).closest("tr").attr("data-hour");
						$("#specific-time-post").empty();
						$.each(course_of_day[day][hour], function(ik, iv){	
							if(iv.for_dept==major){//判斷如果不是這個系的課就不要顯示出來，以後應該可以再按照系級進化陣列
								bulletin_post($("#specific-time-post"),course_of_day[day][hour][ik], "zh_TW");	//因為我把同一時段的課程塞進陣列裡，所以要用index去取
							}											
						})					
					}					
				});
				$("#elective-check").change(function(){//用來檢查勾選表被選了沒
					if ($(this).prop("checked")){//如果選了，就設定成隱藏的css屬性
						$("#elective-post").css("display", "none");
					};
					if($(this).prop("checked")==false){//如果沒有就恢復成空的
						$("#elective-post").css("display", "");
					}
				});
				$("#specific-time-check").change(function(){
					if ($(this).prop("checked")){
						$("#specific-time-post").css("display", "none");
					};
					if($(this).prop("checked")==false){
						$("#specific-time-post").css("display", "");
					}
				});
				$("#specific-check").change(function(){
					if ($(this).prop("checked")){
						$("#specific-post").css("display", "none");
					};
					if($(this).prop("checked")==false){
						$("#specific-post").css("display", "");
					}
				});
				$("#general-check").change(function(){
					if ($(this).prop("checked")){
						$("#general-post").css("display", "none");
					};
					if($(this).prop("checked")==false){
						$("#general-post").css("display", "");
					}
				});
				$("#PE-check").change(function(){
					if ($(this).prop("checked")){
						$("#PE-post").css("display", "none");
					};
					if($(this).prop("checked")==false){
						$("#PE-post").css("display", "");
					}
				});
			});

			
			window.week = ["一", "二", "三", "四", "五"];
			/************這是用來把課程放到右邊的欄位**************/
			var bulletin_post = function($target,course, language){	
			 	if( $.type(course.title_parsed)!=="object" )			//判斷課程名稱是不是物件
					throw 'title_parsed error';
				if( language=="zh_TW" ){
					course.title_short = course.title_parsed["zh_TW"];		//title_short是會自動宣告的區域變數，存沒有英文的課名			  	
				}
				else{
					course.title_short = course.title_parsed["en_US"];			  	
				}				
				var time = [];//time設定為空陣列
				var $td;
				time.push("上課時間:");
				$.each(course.time_parsed, function(ik, iv){		
					time.push("星期"+week[iv.day-1]+iv.time);//push是把裡面的元素變成陣列的一格		
				})
				time = time.join(' ');//把多個陣列用;分隔並合併指派給time
				//var time = course.time_parsed.day+course.time_parsed.time;
				var $option = $($.parseHTML('<option title="" style="color:#3074B5;" value=""></option>'));//把option做成dom，再把dom做成jQuery物件
				$option.text(course.title_short);	//將對應的課程內容寫入cell的html語法中	
				$option.attr("title", time);//在title裡面放課堂時間
				$option.val(course.code);
				//把現在找到的這門選修課課程代碼儲存到這個option，並用value表示
				$target.append($option);		//顯示課程，把$option放到elective-post，append是追加在後面
			 };
			 var add_course = function($target, course, language) {		//假設target為time-table的參數，course為courses的某一個課程
				if( !$.isArray(course.time_parsed) )
					throw 'time_parsed error';		//判斷time-parsed是不是陣列
				if( $.type(course.title_parsed)!=="object" )			//判斷課程名稱是不是物件
					throw 'title_parsed error';
				if(language == "zh_TW"){
					var tmpCh = course.title_parsed["zh_TW"].split(' ');		//(這是中文課名)切割課程名稱，遇到空格就切開
					course.title_short = tmpCh[0];		//title_short是會自動宣告的區域變數，存沒有英文的課名			  	
				}
				else{
					var tmpEn = course.title_parsed["en_US"];
					course.title_short = tmpEn;			  	
				}		
				var stop_day,stop_time;	//這裡是刪除課程應該要停止的星期與節數
				var check_conflict = false;	//他用來判斷是否衝堂，如果有則下面的if就會讓最外圈的each停止
				$.each(course.time_parsed,function(ik, iv){
					$.each(iv.time,function(jk, jv){
						var $td = $target.find('tr[data-hour=' + jv + '] td:eq(' + (iv.day-1) + ')');
						if($td.text()!=""){							
							check_conflict = true;
							alert("衝堂喔!請手動刪除衝堂的課程"+"\n"+"opps!You are not available at that 	time! Please drop out some class");
							return false;//傳回false就是跳離迴圈
						}	
					});
					if(check_conflict==true){
						return false;
					}
				});
				if(check_conflict==false){
					$.each(course.time_parsed, function(ik, iv){							
						$.each(iv.time, function(jk, jv){		//同上，iv.	time為"time"的陣列{3,4}，jk為0~1、jv為3~4(節數)					
							var $td = $target.find('tr[data-hour=' + jv + '] td:eq(' + (iv.day-1) + ')');	
						  var $cell = $($.parseHTML('<div><div><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span><input type="hidden" name="code-of-course" value=""></button></div><div class="title"></div><div class="row"><div class="professor col-xs-6"></div><div class="location col-xs-6"></div>'));						
							//把上面的html格式匯入找到的td type中(	parseHtml把後面的包裝成dom，再用一個$包裝成jQuery物件)							
							$cell.find('.title').text(course.title_short).end()
							$cell.find('input').val(course.code).end()		//	將對應的課程內容寫入cell的html語法中，.title就是class="title"
							     .find('.professor').text(course.professor).end()//text()	會把東西填入找到的class那裡，end()會回到var $cell那一行
							     .find('.location').text(course.location);								
							$td.html($cell.html());		//顯示課程，把cell.html()塞到<td>tag裡面
						});
					});
					add_credits(course);
				}
				
			};

			/**********這是用來刪除衝堂的課程***********/
			var delete_conflict = function($target, course, stop_day, stop_time) {		
			//假設target為time-table的參數，course為courses的某一個課程
				$.each(course.time_parsed, function(ik, iv){
					//each是for迴圈 time-parsed[{...}, {...}]，以微積分為例:一個{"day"+"time"}就是陣列的一格，所以ik為0~1(兩次)	
					var already_delete = false;
					if(already_delete){
						return false;
					}
					$.each(iv.time, function(jk, jv){		//同上，iv.time為"time"的陣列{3,4}，jk為0~1、jv為3~4(節數)
						if(iv.day==stop_day&&jv==stop_time){
							already_delete=true;
							return false;
						}
						//console.log("刪掉了"+iv.day+" "+jv+" ");
						var $td = $target.find('tr[data-hour=' + jv + '] td:eq(' + (iv.day-1) + ')');	
						//td:eq()為搜尋td的陣列索引值，找到課程的時間	iv.day為星期，但因為td為陣列所以iv.day要減一	 find()是找class!!	
						//console.log($td);			
						$td.empty();	//顯示課程，把cell.html()塞到<td>tag裡面
					})
				})
			};

			/**********這個函式是用來刪除一整門課程的**********/
			var delete_course = function($target, course) {
			//假設target為time-table的參數，course為courses的某一個課程				
				$.each(course.time_parsed, function(ik, iv){
				//each是for迴圈 time-parsed[{...}, {...}]，以微積分為例:一個{"day"+"time"}就是陣列的一格，所以ik為0~1(兩次)
					$.each(iv.time, function(jk, jv){		//同上，iv.time為"time"的陣列{3,4}，jk為0~1、jv為3~4(節數)
						var $td = $target.find('tr[data-hour=' + jv + '] td:eq(' + (iv.day-1) + ')');	
						//td:eq()為搜尋td的陣列索引值，找到課程的時間	iv.day為星期，但因為td為陣列所以iv.day要減一	 find()是找class!!
						$td.empty();	//顯示課程，把cell.html()塞到<td>tag裡面
					})
				})
				minus_credits(course);
			};
			var add_credits = function(course){//增加學分
				window.credits+=parseInt(course.credits);//要先把字串型態的學分轉成int才能做加減
				$("#class_credit").val(window.credits);
			};
			var minus_credits = function(course){
				window.credits-=parseInt(course.credits);
				$("#class_credit").val(window.credits);
			};
			var reset=function(){
				$('#time-table td').empty(); //把目前的time-table清空，好讓下個年級的課程能夠乾淨的顯示
				$('#elective-post').empty();//以下是要清掉選修課程、指定時間搜尋等課程
				$('#specific-time-post').empty();
				$('#specific-post').empty();
				$('#general-post').empty();
				$('#PE-post').empty();
				$("#class_credit").val(0);
			}			
		})(jQuery);
	    </script>
        </body>
    </html>
