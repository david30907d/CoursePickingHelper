<!DOCTYPE html>
<html lang="zh-tw" class="han-la">
	<head>
	    <meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
	    <title>選課小幫手</title>
	    <script type="text/javascript"></script>
			<link href="https://cdnjs.cloudflare.com/ajax/libs/Han/2.3.0/han.css" rel="stylesheet">
	    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootst	rap/3.3.1/css/bootstrap.min.css">
	    <link href="font-awesome-4.3.0/css/font-awesome.min.css" rel="stylesheet">	    
	    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	    <script src="https://cdnjs.cloudflare.com/ajax/libs/Han/2.3.0/han.js"></script>
	    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
		<style> 
		    /*這裡開始是我寫的，選取表單和選單上的id，並把顏色反白*/
		    #icon-text, #icon-text1, #icon-text2, #icon-text3, #icon-text4, #icon-text5 
		    {
		    	color: white;
		     	font-family: "Microsoft JhengHei";
		     	font-size: 100%;
		     	font-style: italic;
		    }
		    body 
		    {
		        background-color:#3074B5;
		        background-repeat:no-repeat;
		        background-attachment: fixed;
		        font-family: "Microsoft JhengHei";

		    }
		    p strong
		    {
		    	color: blue
		    }
		    #imgfb
		    {
		    	height: 148px;
		    }
		    #lead
		    {
		    	font-size: 40px;
		    	font-weight: 20;
		    }
		    /*最後改的p是相簿的英文字*/
		    #elective-post
		    {
		    	margin-bottom: 10px;
		    }
			#classification div div
			{
				padding: 0;
			}
		    /*修改table的border*/
			#time-table tbody th{
				white-space: nowrap;
				font-size: 80%;
				height:55px;
			}

			#time-table th{
				text-align: center;
			}
			#time-table button.btn-link{
				text-align: center;
				color:black;
			}
			#time-table div.title{
				text-align: center;
				font-size: 120%;
				padding-bottom: 3px;
			}
			#time-table div.location{
				text-align: left;
				font-size: 80%;
			}
			#time-table div.professor{
				text-align: right;
				font-size: 80%;
			}

		    /*table的屬性結束*/
	 	</style>

	</head>
	

	<body>
		
		<!--選取系級的表單結束-->
		<div class="container-fluid">  
				<div class="col-sm-9">
					<h2 style="text-align:center;" id="curriculum-title">課表</h2>
					<div class="table-responsive" id="time-table">
						<table class="table table-striped table-hover table-condensed table-bordered">
							<thead>
								<tr class="info">
									<th style="width: 1px">時間</th>
									<th style="width: 20%">一</th>
									<th style="width: 20%">二</th>
									<th style="width: 20%">三</th>
									<th style="width: 20%">四</th>
									<th style="width: 20%">五</th>
								</tr>
							</thead>
							<tbody>
								<tr data-hour="1" class="active">
									<th>08:10 - 09:00</th>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
								</tr>
								<tr data-hour="2" class="active">
									<th>09:10 - 10:00</th>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
								</tr>
								<tr data-hour="3" class="active">
									<th>10:10 - 11:00</th>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
								</tr>
								<tr data-hour="4" class="active">
									<th>11:10 - 12:00</th>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
								</tr>
								<tr data-hour="5" class="active">
									<th>13:10 - 14:00</th>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
								</tr>
								<tr data-hour="6" class="active">
									<th>14:10 - 15:00</th>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
								</tr>
								<tr data-hour="7" class="active">
									<th>15:10 - 16:00</th>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
								</tr>
								<tr data-hour="8" class="active">
									<th>16:10 - 17:00</th>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

			<!--會出現系選修和體育、通識-->
			<div class="col-sm-3" id="classification">

				<div calss="row">
					<div class="col-xs-2  col-xs-offset-1">
						<button type="button" class="btn btn-success btn-block" data-toggle="modal" data-target="#exp">
				  		<span class="fa fa-question fa-1x fa-fw"></span>
						</button>
					</div>
					<div class="col-xs-2">
						<button type="button" class="btn btn-info btn-block" data-toggle="modal" data-target="#detail">
				  		<span class="fa fa-graduation-cap fa-1x fa-fw"></span>
						</button>
					</div>
					<div class="col-xs-2">
						<button type="button" class="btn btn-warning btn-block" data-toggle="modal" data-target="#search">
				  		<span class="fa fa-search fa-1x fa-fw"></span>
						</button>
					</div>
					<div class="col-xs-2">
						<button type="button" class="btn btn-danger btn-block" id="clear-button">
				  		<span class="fa fa-trash fa-1x fa-fw"></span>
						</button>
					</div>
					<div class="col-xs-2">
						<button type="button" class="btn btn-danger btn-block" id="change-language" value="zh_TW">
				  		<span class="fa fa-language fa-1x fa-fw"></span>
						</button><!--中英切換-->
					</div>
 				</div>

				<div calss="row">
				<div class="col-sm-12" style = "background-color:#D9EDF7">
					<div calss="row">
						<div class="col-sm-4 col-xs-4"><input type="checkbox" value="">系選修</div>
						<div class="col-sm-4 col-xs-4"><input type="checkbox" value="">通識</div>
						<div class="col-sm-4 col-xs-4"><input type="checkbox" value="">體育</div>
					</div>
				<select multiple class="form-control" id="elective-post">
					
				</select>
				</div>
			</div>
			

			<!-- Modal -->
			<div class="modal fade modal fade bs-example-modal-lg" id="exp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			  <div class="modal-dialog modal-lg">
			    <div class="modal-content">
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>

			        <h3 class="modal-title" id="myModalLabel"><span class="fa fa-question fa-1x fa-fw"></span>使用說明</h3>

			      </div>





			      <div class="modal-body">
					<!--杜杰的圖片輪播-->
					<div class="container-fluid">
						<div class="row">
							<div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
						    <!-- Indicators -->
						      <ol class="carousel-indicators">
										<li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
										<li data-target="#carousel-example-generic" data-slide-to="1"></li>
										<li data-target="#carousel-example-generic" data-slide-to="2"></li>
						      </ol>

						    	<!-- Wrapper for slides -->
						    	<div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
						          <!-- Indicators -->
									<ol class="carousel-indicators">
										<li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
										<li data-target="#carousel-example-generic" data-slide-to="1"></li>
										<li data-target="#carousel-example-generic" data-slide-to="2"></li>
									</ol>

						      <!-- Wrapper for slides -->
						      <div class="carousel-inner" role="listbox">
						        <div class="item active">
											<div align="center">
												<img src="images/test5.jpg" style="width:100%; height:100%">
											</div>
											<div class="carousel-caption">
						          	<h3>Test1</h3>
						        	</div>
						      	</div>

						        <div class="item">
											<div align="center">
												<img src="images/test4.jpg" style="width:100%; height:100%">
											</div>
											<div class="carousel-caption">
												<h3>Test2</h3>
											</div>
						        </div>

										<div class="item">
											<div align="center">
												<img src="images/test6.jpg" style="width:100%; height:100%">
											</div>
											<div class="carousel-caption">
												<h3>Test3</h3>
											</div>
										</div>
									</div>
									<!-- Controls -->
									<a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
										<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
										<span class="sr-only">Previous</span>
									</a>
									<a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
										<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
										<span class="sr-only">Next</span>
									</a>
						        </div>
						 	</div>
						</div>
					</div>
					<!--杜杰的圖片結束-->
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			      </div>
			    </div>
			  </div>
			</div>

			<div class="modal fade modal fade bs-example-modal-lg" id="detail" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			  <div class="modal-dialog modal-lg">
			    <div class="modal-content">
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			        
			        <h3 class="modal-title" id="myModalLabel">
			        	<span class="fa fa-graduation-cap fa-1x fa-fw"></span> 自動填寫必修課程</h3>

			      </div>
			      <div class="modal-body">
			      	<form class="form-horizontal">
			      	  <div class="form-group">
			      	    <label for="v_year" class="col-sm-2 control-label">學期</label>
			      	    <div class="col-sm-10">
			      	      <select class="form-control" name="v_year" id="v_year">
			      	        <option value="103_2">1032</option>
			      	        <option value="103_1">1031</option>
			      	        <option value="102_2">1022</option>
			      	        <option value="102_1">1021</option>
			      	      </select>
			      	    </div>
			      	  </div>
			      	  <div class="form-group">
			      	    <label for="v_career" class="col-sm-2 control-label">學制</label>
			      	    <div class="col-sm-10">
			      	      <select class="form-control" name="v_career" id="v_career">
			      	        <option value="U">學士班</option>
			      	        <option value="G">碩士班</option>
			      	        <option value="D">博士班</option>
			      	        <option value="R">產專班</option>
			      	        <option value="W">碩專班</option>
			      	        <option value="N">進修學士班</option>
			      	      </select>
			      	    </div>
			      	  </div>
			      	  <div class="form-group">
			      	    <label for="v_dept" class="col-sm-2 control-label">系所</label>
			      	    <div class="col-sm-10">
			      	      <select class="form-control" name="v_dept" id="v_dept">
			      	        <option value="C10">文學院</option>
			      	        <option value="C20">管理學院</option>
			      	        <option value="C30">農業暨自然資源學院</option>
			      	        <option value="U11">中國文學系學士班</option>
			      	        <option value="U12">外國語文學系學士班</option>
			      	        <option value="U13">歷史學系學士班</option>
			      	        <option value="U21">財務金融學系學士班</option>
			      	        <option value="U23">企業管理學系學士班</option>
			      	        <option value="U24">法律學系學士班</option>
			      	        <option value="U28">會計學系學士班</option>
			      	        <option value="U29">資訊管理學系學士班</option>
			      	        <option value="U30F">景觀與遊憩學士學位學程</option>
			      	        <option value="U30G">生物科技學士學位學程</option>
			      	        <option value="U30H">國際農企業學士學位學程</option>
			      	        <option value="U31">農藝學系學士班</option>
			      	        <option value="U32">園藝學系學士班</option>
			      	        <option value="U33A">森林學系林學組學士班</option>
			      	        <option value="U33B">森林學系木材科學組學士班</option>
			      	        <option value="U34">應用經濟學系學士班</option>
			      	        <option value="U35">植物病理學系學士班</option>
			      	        <option value="U36">昆蟲學系學士班</option>
			      	        <option value="U37">動物科學系學士班</option>
			      	        <option value="U38A">獸醫學系學士班</option>
			      	        <option value="U38B">獸醫學系學士班</option>
			      	        <option value="U39">土壤環境科學系學士班</option>
			      	        <option value="U40">生物產業機電工程學系學士班</option>
			      	        <option value="U42">水土保持學系學士班</option>
			      	        <option value="U43">食品暨應用生物科技學系學士班</option>
			      	        <option value="U44">行銷學系學士班</option>
			      	        <option value="U51">化學系學士班</option>
			      	        <option value="U52">生命科學系學士班</option>
			      	        <option value="U53A">應用數學系學士班</option>
			      	        <option value="U53B">應用數學系學士班</option>
			      	        <option value="U54A">物理學系一般物理組學士班</option>
			      	        <option value="U54B">物理學系光電物理組學士班</option>
			      	        <option value="U56">資訊科學與工程學系學士班</option>
			      	        <option value="U60F">學士後太陽能光電系統應用學士學位學程</option>
			      	        <option value="U61B">機械工程學系學士班</option>
			      	        <option value="U61A">機械工程學系學士班</option>
			      	        <option value="U62A">土木工程學系學士班</option>
			      	        <option value="U62B">土木工程學系學士班</option>
			      	        <option value="U63">環境工程學系學士班</option>
			      	        <option value="U64B">電機工程學系學士班</option>
			      	        <option value="U64A">電機工程學系學士班</option>
			      	        <option value="U65">化學工程學系學士班</option>
			      	        <option value="U66">材料科學與工程學系學士班</option>
			      	      </select>
			      	    </div>
			      	  </div>
			      	  <div class="form-group">
			      	    <label for="v_level" class="col-sm-2 control-label">年級</label>
			      	    <div class="col-sm-10">
			      	      <select class="form-control" name="v_level" id="v_level">                    
			      	        <option value="1">一年級</option>
			      	        <option value="2">二年級</option>
			      	        <option value="3">三年級</option>
			      	        <option value="4">四年級</option>
			      	        <option value="5">五年級</option>
			      	      </select>
			      	    </div>
			      	  </div>
			      	</form>
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			        <button type="button" class="btn btn-success" data-dismiss="modal" id="ok-button">Submit</button>
			      </div>
			    </div>
			  </div>
			</div>

			<div class="modal fade modal fade bs-example-modal-lg" id="search" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			  <div class="modal-dialog modal-lg">
			    <div class="modal-content">
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			        <h3 class="modal-title" id="myModalLabel"><span class="fa fa-search fa-1x fa-fw"></span>課程查詢</h3>
			      </div>
			      <div class="modal-body">

					<div class="form-group">
						<label for="class_title" class="col-sm-3 control-label">課程名稱</label>
						<div class="col-sm-9">
					    	<input type="class" class="form-control" id="class_title">
						</div>
					</div>
					<div class="form-group">
						<label for="class_code" class="col-sm-3 control-label">課程代碼</label>
						<div class="col-sm-9">
					    	<input type="class" class="form-control" id="class_code">
						</div>
					</div>
					<div class="form-group">
						<label for="class_teacher" class="col-sm-3 control-label">授課教師</label>
						<div class="col-sm-9">
					    	<input type="teacher" class="form-control" id="class_teacher">
					  	</div>
					</div>
					
					<div class="row">
					    <a class="btn btn-lg col-sm-3 col-sm-offset-1" href="https://onepiece.nchu.edu.tw/cofsys/plsql/crseqry_home" target="_blank"><span class="fa fa-graduation-cap fa-1x fa-fw"></span>選課系統</a>
	        	        <a class="btn btn-lg col-sm-3" href="http://cah.nchu.edu.tw/class/class_plan.php?new=Y&d_id=3" target="_blank"><span class="fa fa-book fa-1x fa-fw"></span>通識中心</a>
	            	    <a class="btn btn-lg col-sm-3" href="https://nchu-am.nchu.edu.tw/nidp/idff/sso?id=3&sid=0&option=credential&sid=0" target="_blank"><span class="fa fa-external-link fa-1x fa-fw"></span>單一簽入</a>
            	    </div>

			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			      </div>
			      <div>
			      	<button type="button" class="btn btn-success" data-dismiss="modal" id="specific_search">Submit</button>
			      </div>			      
			    </div>
			  </div>
			</div>

		</div>

	  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	    <script>


		(function($){
		//先定義JQuery為$，不要讓它衝突
		//var courses = null;
		  $(function(){
				//當文件準備好的時候，讀入json檔
				$.getJSON('json/course.json', function(json){  //getJSON會用function(X)傳回X的物件或陣列
					window.courses = {};//宣告一個空的物件
					window.course_of_majors = {};//宣告一個空的物件
					$.each(json.course, function(ik,iv){
						if(typeof(window.course_of_majors[iv.for_dept]) == 'undefined')//如果這一列(列的名稱為索引值key)是空的也就是undefined，那就對他進行初始化，{}物件裡面可以放任意的東西，在下面會把很多陣列塞進這個物件裡面
							window.course_of_majors[iv.for_dept] = {};
						if(typeof(window.course_of_majors[iv.for_dept][iv.class]) == 'undefined'){
							window.course_of_majors[iv.for_dept][iv.class] = [];//如果這一行(列的名稱為索引值key)是空的也就是undefined，那就對他進行初始化，[]裡面的是放陣列
						}
						window.course_of_majors[iv.for_dept][iv.class].push(iv.code);//把東西推進這個陣列裡，概念跟stack一樣
						window.courses[iv.code] = iv;//這邊可以直接把選課號當作索引值key，裡面的值為object				
					});
					//console.log(window.courses, window.course_of_majors);
				});
				$("#v_career").change(function()
				{
					select_degree($("#v_career").val());
				});
				//var select_degree = function(degree)
				var select_degree = function(degree)
				{
					cozsnsole.log(degree);
					switch(degree)
					{
						case "U":

						case "G":
							$("#v_dept").prepend("<option value='100'>OK!!</option>");
							break;
						case "D":
							break;
						case "R":

						case "W":

						case "N":

					}

				};	
				/*//這段是軍民的原始碼
				var serializearray=function(){//比較好的方法來取option 的value!!!!
					$a = $($0)//取到年級選單
					//[<form class=​"form-horizontal">​…​</form>​]
					$a.serializeArray()
					[Objectname: "v_year"value: "103_2"__proto__: Object, Objectname: "v_career"value: "U"__proto__: Object, Objectname: "v_dept"value: "C10"__proto__: Object, Objectname: "v_level"value: "1"__proto__: Object]
					$a.serializeArray()[0].name
					"v_year"
					$a.serializeArray()[1].value
					"U"
				}*/	
				$("#specific_search").click(function(){	//
					var code = $("#class_code").val();
					var language = $("#change-language").val();
					elective_course(courses[code],language);
				})


				$("#elective-post").delegate("option","click",function(){//delegate可以去抓到還不存在的東西，第一個$()是指作用的區域，delegate的()裡面就是option，dblclick是事件
					var boolean = confirm("確認添加此課程?"+"\n"+"Are you sure to enroll this class?");
					if(boolean){
						var language=$("#change-language").val();
						//var index=$(this).val();
						//course=courses[index];				
						var course = $(this).data("class");//this會代表我抓到的那個東西，也就是option
						add_course($('#time-table'),course, language);	
					}										
				});

				$("#ok-button").click(function()
				{											
					var level = $("#v_level").val();
					$('#time-table td').empty();
					var language = $("#change-language").val();
					$.each(courses,function(ik,iv)
					{
						if(iv.class==level&&iv.obligatory_tf==true)
						{
							add_course($('#time-table'),courses[ik],language);
						}	
						else if(iv.class==level&&iv.obligatory_tf==false)
						{
							elective_course(courses[ik],language);
						}						
					})							
				});

				$("#clear-button").click(function()
				{
					$('#time-table td').empty(); //把目前的time-table清空，好讓下個年級的課程能夠乾淨的顯示
					$('#elective-post').empty();//清掉選修課程
				});
				$("#time-table").delegate("span","click",function(){//這是用來把一整個課程都刪掉的按鈕
					$target = $(this).closest("td");
					var code = $(this).next("input").val();
					var boolean = confirm("是否刪除此課程?"+"\n"+"Are you sure you really want to drop this course?");					
					if(boolean){
						delete_course($('#time-table'),courses[code]);	//就跟add_course一樣，只是把填東西改成刪掉						
					}					
				})				
				$("#change-language").click(function()
				{
					if($("#change-language").val()=="zh_TW")
						$("#change-language").val("en_US");
					else
						$("#change-language").val("zh_TW");
				});
			});

			var week = ["一", "二", "三", "四", "五"];
			var elective_course = function(course,language){	
			 	if( $.type(course.title_parsed) !== "object")			//判斷課程名稱是不是物件
					throw 'title_parsed error';
				if(language=="zh_TW"){
					course.title_short = course.title_parsed["zh_TW"];		//title_short是會自動宣告的區域變數，存沒有英文的課名
			  	//console.log( "這是中文的"+course.title_shortCh);
				}
				else{
					course.title_short = course.title_parsed["en_US"];
			  	//console.log(course.title_shortEn);
				}
				var $elective = $("#elective-post");
				var time = [];//time設定為空陣列
				var $td;
				$.each(course.time_parsed, function(ik, iv){		
					time.push("星期" + week[iv.day-1] +iv.time);//push是把裡面的元素變成陣列的一格		
				})
				time = time.join('; ');//把多個陣列用;分隔並合併指派給time
				//var time = course.time_parsed.day+course.time_parsed.time;
				var $option = $($.parseHTML('<option title="" style="color:#3074B5;"></option>'));//把option做成dom，再把dom做成jQuery物件
				$option.text(course.title_short);	//將對應的課程內容寫入cell的html語法中	
				$option.attr("title",time);//在title裡面放課堂時間
				$option.data("class",course);	//把現在找到的這門選修課處存到這個option，並用class表示
				$elective.append($option);		//顯示課程，把cell.html()塞到<td>tag裡面
			 };
			 var add_course = function($target, course, language) {		//假設target為time-table的參數，course為courses的某一個課程
				if( !$.isArray(course.time_parsed) )
					throw 'time_parsed error';		//判斷time-parsed是不是陣列
				if( $.type(course.title_parsed) !== "object")			//判斷課程名稱是不是物件
					throw 'title_parsed error';
				if(language=="zh_TW"){
					var tmpCh = course.title_parsed["zh_TW"].split(' ');		//(這是中文課名)切割課程名稱，遇到空格就切開
					course.title_short = tmpCh[0];		//title_short是會自動宣告的區域變數，存沒有英文的課名
			  	//console.log( "這是中文的"+course.title_shortCh);
				}
				else{
					var tmpEn = course.title_parsed["en_US"];
					course.title_short = tmpEn;
			  	//console.log(course.title_shortEn);
				}		
				var stop_day,stop_time;	//這裡是刪除課程應該要停止的星期與節數
				var check_conflict = false;	//他用來判斷是否衝堂，如果有則下面的if就會讓最外圈的each停止
				$.each(course.time_parsed, function(ik, iv){
					//each是for迴圈 time-parsed[{...}, {...}]，以微積分為例:一個{"day"+"time"}就是陣列的一格，所以ik為0~1(兩次)								
					if(check_conflict){
						//console.log(check_conflict);
						console.log($target+course+stop_day+stop_time);
						delete_conflict($target, course,stop_day,stop_time);
						return false;
					}			
					//console.log(check_conflict);
					//console.log($target+course+stop_day+stop_time);		
					$.each(iv.time, function(jk, jv){		//同上，iv.time為"time"的陣列{3,4}，jk為0~1、jv為3~4(節數)					
						var $td = $target.find('tr[data-hour=' + jv + '] td:eq(' + (iv.day-1) + ')');	
						//td:eq()為搜尋td的陣列索引值，找到課程的時間	iv.day為星期，但因為td為陣列所以iv.day要減一	 find()是找class!!		
						if($td.text()!=""){
							stop_day=iv.day;
							stop_time=jv;
							check_conflict=true;
							delete_conflict($target, course,stop_day,stop_time);
							alert("衝堂喔!請手動刪除衝堂的課程"+"\n"+"opps!You are not available at that time! Please drop out some class");
							return false;
						}	
						else{
							var $cell = $($.parseHTML('<div><div><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span><input type="hidden" name="code-of-course" value=""></button></div><div class="title"></div><div class="row"><div class="professor col-xs-6"></div><div class="location col-xs-6"></div>'));						
							//把上面的html格式匯入找到的td type中(	parseHtml把後面的包裝成dom，再用一個$包裝成jQuery物件)
							// console.log($cell[0]);
							$cell.find('.title').text(course.title_short).end()
							$cell.find('input').val(course.code).end()		//	將對應的課程內容寫入cell的html語法中，.title就是class="title"
							     .find('.professor').text(course.professor).end()//text()	會把東西填入找到的class那裡，end()會回到var $cell那一行
							     .find('.location').text(course.location);	
							//$cell.attr("code-value",course.code);
							//$cell.attr("value",course.code);	//	我想要把選課號放進val裡面，可是抓出來都是空的
							//console.log($cell.code_value);
							$td.html($cell.html());		//顯示課程，把cell.html()塞到<td>tag裡面
						}							
					})
				})
			};
			var delete_conflict = function($target, course,stop_day,stop_time) {		//這是用來刪除衝堂的課程
			//假設target為time-table的參數，course為courses的某一個課程
				$.each(course.time_parsed, function(ik, iv){
					//each是for迴圈 time-parsed[{...}, {...}]，以微積分為例:一個{"day"+"time"}就是陣列的一格，所以ik為0~1(兩次)	
					var already_delete = false;
					if(already_delete){
						return false;
					}
					$.each(iv.time, function(jk, jv){		//同上，iv.time為"time"的陣列{3,4}，jk為0~1、jv為3~4(節數)
						if(iv.day==stop_day&&jv==stop_time){
							already_delete=true;
							return false;
						}
						//console.log("刪掉了"+iv.day+" "+jv+" ");
						var $td = $target.find('tr[data-hour=' + jv + '] td:eq(' + (iv.day-1) + ')');	
						//td:eq()為搜尋td的陣列索引值，找到課程的時間	iv.day為星期，但因為td為陣列所以iv.day要減一	 find()是找class!!	
						//console.log($td);			
						$td.empty();	//顯示課程，把cell.html()塞到<td>tag裡面
					})
				})
			};
			var delete_course = function($target, course) {		//這個函式是用來刪除一整門課程的
			//假設target為time-table的參數，course為courses的某一個課程				
				$.each(course.time_parsed, function(ik, iv){
				//each是for迴圈 time-parsed[{...}, {...}]，以微積分為例:一個{"day"+"time"}就是陣列的一格，所以ik為0~1(兩次)
					$.each(iv.time, function(jk, jv){		//同上，iv.time為"time"的陣列{3,4}，jk為0~1、jv為3~4(節數)
						var $td = $target.find('tr[data-hour=' + jv + '] td:eq(' + (iv.day-1) + ')');	
						//td:eq()為搜尋td的陣列索引值，找到課程的時間	iv.day為星期，但因為td為陣列所以iv.day要減一	 find()是找class!!				
						$td.empty();	//顯示課程，把cell.html()塞到<td>tag裡面
					})
				})
			};
		})(jQuery);
	    </script>
	</body>
</html>
