<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Document</title>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
	<title>Bootstrap 101 Template</title>
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
	<style>
		body{
			font-family: "Helvetica Neue", Helvetica, Arial, sans-serif, "微軟正黑體";
		}
		#time-table tbody th{
			white-space: nowrap;
			font-size: 80%;
		}
		#time-table th{
			text-align: center;
		}
		#time-table div.title{
			text-align: center;
			font-size: 120%;
			padding-bottom: 3px;
		}
		#time-table div.location{
			text-align: left;
			font-size: 80%;
		}
		#time-table div.professor{
			text-align: right;
			font-size: 80%;
		}
	</style>
</head>
<body>
	<div class="container">
		<h1 class="text-center">hello world</h1>
		<button type="button" class="btn btn-default" id="OK_Button" onclick="alert('請使用者於右下方的欄位自行勾選本年級必修課')">確定</button>
		<div class="table-responsive" id="time-table">
			<table class="table table-striped table-hover table-condensed table-bordered">
				<thead>
					<tr class="info">
						<th style="width: 1px">時間</th>
						<th style="width: 20%">一</th>
						<th style="width: 20%">二</th>
						<th style="width: 20%">三</th>
						<th style="width: 20%">四</th>
						<th style="width: 20%">五</th>
					</tr>
				</thead>
				<tbody>
					<tr data-hour="1">
						<th class="info">08:10 - 09:00</th>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					<tr data-hour="2">
						<th class="info">09:10 - 10:00</th>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					<tr data-hour="3">
						<th class="info">10:10 - 11:00</th>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					<tr data-hour="4">
						<th class="info">11:10 - 12:00</th>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					<tr data-hour="5">
						<th class="info">13:10 - 14:00</th>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					<tr data-hour="6">
						<th class="info">14:10 - 15:00</th>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					<tr data-hour="7">
						<th class="info">15:10 - 16:00</th>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					<tr data-hour="8">
						<th class="info">16:10 - 17:00</th>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
	<script>
	(function($){
		//先定義JQuery為$，不要讓它衝突
		//var courses = null;
		$(function(){
			//當文件準備好的時候，讀入json檔
			$.getJSON('json/nchu_U56.json', function(json){  //getJSON會用function(X)傳回X的物件或陣列
				courses = json.course;
				//把json.course的物件存入courses變數裡
			});
			$('button#OK_Button').click(function()
			{
				add_course($('#time-table'),courses[0]);
				add_course($('#time-table'),courses[1]);
				add_course($('#time-table'),courses[2]);
				add_course($('#time-table'),courses[3]);
				add_course($('#time-table'),courses[4]);											
			});
		});
    
		window.add_course = function($target, course) {		//假設target為time-table的參數，course為courses的某一個課程
			if( !$.isArray(course.time_parsed) )
				throw 'time_parsed error';		//判斷time-parse是不是陣列
			if( $.type(course.title) !== "string" )			//判斷課程是不是字串	
				throw 'title error';
			var tmp = course.title.split(' ');		//切割課程名稱，遇到空格就切開
			course.title_short = tmp[0]+tmp[2];		//title_short是會自動宣告的區域變數，存沒有英文的課名
			// console.log(course.title_short);
			$.each(course.time_parsed, function(ik, iv){		
			//each是for迴圈 time-parsed[{...}, {...}]，以微積分為例:一個{"day"+"time"}就是陣列的一格，所以ik為0~1(兩次)
				$.each(iv.time, function(jk, jv){		//同上，iv.time為"time"的陣列{3,4}，jk為0~1、jv為3~4(節數)
					var $td = $target.find('tr[data-hour=' + jv + '] td:eq(' + (iv.day-1) + ')');		
					//td:eq()為搜尋td的陣列索引值，找到課程的時間	iv.day為星期，但因為td為陣列所以iv.day要減一
					// console.log($td[0]);
					var $cell = $($.parseHTML('<div><div class="title"></div><div class="row"><div class="professor col-xs-6"></div><div class="location col-xs-6"></div></div></div>'));
					//把上面的html格式匯入找到的td type中(parseHtml把後面的包裝成dom，再用一個$包裝成jQuery物件)
					// console.log($cell[0]);
					$cell.find('.title').text(course.title_short).end()		//將對應的課程內容寫入cell的html語法中，.title就是class="title"
					     .find('.professor').text(course.professor).end()//text()會把東西填入找到的class那裡，end()會回到var $cell那一行
					     .find('.location').text(course.location);

					// console.log($cell[0]);
					$td.html($cell.html());		//顯示課程
				})
			})
		}
	})(jQuery);

	</script>
</body>
</html>